{"ast":null,"code":"import _objectSpread from\"C:/Users/ishik/VS code/Form/dynamic-form-builder/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useCallback}from'react';import{Box,Button,MenuItem,Select,TextField,Typography,Checkbox,FormControlLabel,Dialog,DialogTitle,DialogContent,DialogActions,List,ListItem,IconButton,Divider,Radio,Paper,Alert}from'@mui/material';import{v4 as uuidv4}from'uuid';import{SvgIcon}from'@mui/material';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DeleteIcon=props=>/*#__PURE__*/_jsx(SvgIcon,_objectSpread(_objectSpread({},props),{},{children:/*#__PURE__*/_jsx(\"path\",{d:\"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z\"})}));const CreateForm=()=>{const[fields,setFields]=useState([]);const[newField,setNewField]=useState('text');const[formName,setFormName]=useState('');const[openDialog,setOpenDialog]=useState(false);const[showPreview,setShowPreview]=useState(false);const[previewValues,setPreviewValues]=useState({});const evalFormula=useCallback((formula,context)=>{try{const safeContext=_objectSpread({},context);const helpers={Date:Date,Math:Math,parseInt:parseInt,parseFloat:parseFloat,calculateAge:birthDate=>{if(!birthDate)return 0;const today=new Date();const birth=new Date(birthDate);if(isNaN(birth.getTime()))return 0;let age=today.getFullYear()-birth.getFullYear();const monthDiff=today.getMonth()-birth.getMonth();if(monthDiff<0||monthDiff===0&&today.getDate()<birth.getDate()){age--;}return age;}};const evalContext=_objectSpread(_objectSpread({},safeContext),helpers);const params=Object.keys(evalContext);const values=Object.values(evalContext);const func=new Function(...params,\"\\\"use strict\\\"; return (\".concat(formula,\");\"));return func(...values);}catch(error){console.error('Formula evaluation error:',error,'Formula:',formula,'Context:',context);return'Error';}},[]);const updateDerivedFields=useCallback(values=>{const newValues=_objectSpread({},values);let hasChanges=false;fields.forEach(field=>{if(field.derived&&field.parentFields&&field.formula){const context={};let hasAllParents=true;field.parentFields.forEach(parentId=>{const parentField=fields.find(f=>f.id===parentId);if(parentField&&parentId in values){context[parentField.label.toLowerCase().replace(/\\s+/g,'_')]=values[parentId];}else{hasAllParents=false;}});if(hasAllParents){const computedValue=evalFormula(field.formula,context);if(newValues[field.id]!==computedValue){newValues[field.id]=computedValue;hasChanges=true;}}}});if(hasChanges){setPreviewValues(newValues);}},[fields,evalFormula]);const addField=()=>{const id=uuidv4();const field={id,type:newField,label:'',validation:{required:false},options:newField==='select'?[]:undefined};if(['select','radio','checkbox'].includes(newField)){field.options=['Option 1','Option 2'];}setFields(prev=>[...prev,field]);};const updateField=(id,updated)=>{setFields(prev=>prev.map(field=>field.id===id?_objectSpread(_objectSpread({},field),updated):field));};const deleteField=id=>{setFields(prev=>prev.filter(field=>field.id!==id));setPreviewValues(prev=>{const newValues=_objectSpread({},prev);delete newValues[id];return newValues;});};const saveForm=()=>{const formSchema={name:formName,fields,createdAt:new Date().toISOString()};localStorage.setItem(\"form_\".concat(formName),JSON.stringify(formSchema));setOpenDialog(false);alert('Form saved successfully!');setFields([]);setFormName('');setPreviewValues({});};const handlePreviewChange=(fieldId,value)=>{const newValues=_objectSpread(_objectSpread({},previewValues),{},{[fieldId]:value});setPreviewValues(newValues);updateDerivedFields(newValues);};const getAvailableParentFields=currentFieldId=>{return fields.filter(f=>f.id!==currentFieldId&&!f.derived&&f.label.trim()!=='');};const renderPreviewField=field=>{var _previewValues$field$,_field$options,_field$options2,_field$options3;const value=(_previewValues$field$=previewValues[field.id])!==null&&_previewValues$field$!==void 0?_previewValues$field$:field.type==='checkbox'?[]:'';if(field.derived){return/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"\".concat(field.label,\" (Auto-calculated)\"),value:value,disabled:true,margin:\"normal\",sx:{'& .MuiInputBase-input':{color:'text.secondary'}}},field.id);}switch(field.type){case'text':case'number':case'date':return/*#__PURE__*/_jsx(TextField,{type:field.type,fullWidth:true,label:field.label,value:value,onChange:e=>handlePreviewChange(field.id,e.target.value),margin:\"normal\"},field.id);case'textarea':return/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:field.label,value:value,onChange:e=>handlePreviewChange(field.id,e.target.value),multiline:true,rows:3,margin:\"normal\"},field.id);case'select':return/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{children:field.label}),/*#__PURE__*/_jsx(Select,{fullWidth:true,value:value,onChange:e=>handlePreviewChange(field.id,e.target.value),children:(_field$options=field.options)===null||_field$options===void 0?void 0:_field$options.map((opt,i)=>/*#__PURE__*/_jsx(MenuItem,{value:opt,children:opt},i))})]},field.id);case'radio':return/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{children:field.label}),(_field$options2=field.options)===null||_field$options2===void 0?void 0:_field$options2.map((opt,i)=>/*#__PURE__*/_jsx(FormControlLabel,{value:opt,control:/*#__PURE__*/_jsx(Radio,{checked:value===opt,onChange:()=>handlePreviewChange(field.id,opt)}),label:opt},i))]},field.id);case'checkbox':return/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{children:field.label}),(_field$options3=field.options)===null||_field$options3===void 0?void 0:_field$options3.map((opt,i)=>/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:Array.isArray(value)&&value.includes(opt),onChange:e=>{const currentValue=Array.isArray(value)?value:[];const newValue=e.target.checked?[...currentValue,opt]:currentValue.filter(v=>v!==opt);handlePreviewChange(field.id,newValue);}}),label:opt},i))]},field.id);default:return null;}};return/*#__PURE__*/_jsxs(Box,{p:3,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:\"Create Dynamic Form\"}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",gap:2,alignItems:\"center\",mb:3,children:[/*#__PURE__*/_jsxs(Select,{value:newField,onChange:e=>setNewField(e.target.value),children:[/*#__PURE__*/_jsx(MenuItem,{value:\"text\",children:\"Text\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"number\",children:\"Number\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"textarea\",children:\"Textarea\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"select\",children:\"Select\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"radio\",children:\"Radio\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"checkbox\",children:\"Checkbox\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"date\",children:\"Date\"})]}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:addField,children:\"Add Field\"}),fields.length>0&&/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:()=>setShowPreview(!showPreview),children:showPreview?'Hide Preview':'Show Preview'})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",gap:3,children:[/*#__PURE__*/_jsxs(Box,{flex:showPreview?1:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Form Builder\"}),/*#__PURE__*/_jsx(List,{children:fields.map((field,index)=>{var _field$defaultValue,_field$options4;return/*#__PURE__*/_jsxs(Box,{mb:3,children:[/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsxs(Box,{width:\"100%\",children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",justifyContent:\"space-between\",mb:1,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",children:[\"Field #\",index+1,\" - \",field.type]}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>deleteField(field.id),children:/*#__PURE__*/_jsx(DeleteIcon,{})})]}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Label\",value:field.label,onChange:e=>updateField(field.id,{label:e.target.value}),margin:\"normal\"}),!field.derived&&/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Default Value\",value:(_field$defaultValue=field.defaultValue)!==null&&_field$defaultValue!==void 0?_field$defaultValue:'',onChange:e=>updateField(field.id,{defaultValue:e.target.value}),margin:\"normal\"}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:field.validation.required,onChange:e=>updateField(field.id,{validation:_objectSpread(_objectSpread({},field.validation),{},{required:e.target.checked})})}),label:\"Required\"}),field.type==='text'||field.type==='textarea'?/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(TextField,{type:\"number\",label:\"Min Length\",value:field.validation.minLength||'',onChange:e=>updateField(field.id,{validation:_objectSpread(_objectSpread({},field.validation),{},{minLength:Number(e.target.value)})}),margin:\"normal\",size:\"small\",sx:{mr:2}}),/*#__PURE__*/_jsx(TextField,{type:\"number\",label:\"Max Length\",value:field.validation.maxLength||'',onChange:e=>updateField(field.id,{validation:_objectSpread(_objectSpread({},field.validation),{},{maxLength:Number(e.target.value)})}),margin:\"normal\",size:\"small\"}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:field.validation.email||false,onChange:e=>updateField(field.id,{validation:_objectSpread(_objectSpread({},field.validation),{},{email:e.target.checked})})}),label:\"Email Format\"}),/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:field.validation.password||false,onChange:e=>updateField(field.id,{validation:_objectSpread(_objectSpread({},field.validation),{},{password:e.target.checked})})}),label:\"Password Rule\"})]})]}):null,/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:field.derived||false,onChange:e=>updateField(field.id,{derived:e.target.checked})}),label:\"Is Derived Field?\"}),field.derived&&/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",gutterBottom:true,children:\"Parent Fields:\"}),getAvailableParentFields(field.id).map(parentField=>{var _field$parentFields;return/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:((_field$parentFields=field.parentFields)===null||_field$parentFields===void 0?void 0:_field$parentFields.includes(parentField.id))||false,onChange:e=>{const current=field.parentFields||[];const updated=e.target.checked?[...current,parentField.id]:current.filter(id=>id!==parentField.id);updateField(field.id,{parentFields:updated});}}),label:\"\".concat(parentField.label,\" (\").concat(parentField.type,\")\")},parentField.id);}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Formula / Logic\",value:field.formula||'',onChange:e=>updateField(field.id,{formula:e.target.value}),margin:\"normal\",helperText:\"Use field labels in lowercase with underscores (e.g., calculateAge(date_of_birth))\"}),field.parentFields&&field.parentFields.length>0&&field.formula&&/*#__PURE__*/_jsxs(Alert,{severity:\"info\",sx:{mt:1},children:[\"Available variables: \",field.parentFields.map(id=>{const parentField=fields.find(f=>f.id===id);return parentField===null||parentField===void 0?void 0:parentField.label.toLowerCase().replace(/\\s+/g,'_');}).join(', ')]})]}),(field.type==='select'||field.type==='radio'||field.type==='checkbox')&&!field.derived&&/*#__PURE__*/_jsxs(Box,{mb:2,children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",children:\"Options\"}),(_field$options4=field.options)===null||_field$options4===void 0?void 0:_field$options4.map((option,optIdx)=>/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",mb:1,gap:1,children:[/*#__PURE__*/_jsx(TextField,{label:\"Option \".concat(optIdx+1),value:option,onChange:e=>{var _field$options5;const newOptions=[...((_field$options5=field.options)!==null&&_field$options5!==void 0?_field$options5:[])];newOptions[optIdx]=e.target.value;updateField(field.id,{options:newOptions});},size:\"small\"}),field.options&&field.options.length>2&&/*#__PURE__*/_jsx(IconButton,{size:\"small\",onClick:()=>{const newOptions=field.options.filter((_,i)=>i!==optIdx);updateField(field.id,{options:newOptions});},children:/*#__PURE__*/_jsx(DeleteIcon,{fontSize:\"small\"})}),/*#__PURE__*/_jsx(FormControlLabel,{control:field.type==='checkbox'?/*#__PURE__*/_jsx(Checkbox,{checked:Array.isArray(field.validation['correctAnswers'])?field.validation['correctAnswers'].includes(option):false,onChange:e=>{let correctAnswers=Array.isArray(field.validation['correctAnswers'])?[...field.validation['correctAnswers']]:[];if(e.target.checked){correctAnswers.push(option);}else{correctAnswers=correctAnswers.filter(ans=>ans!==option);}updateField(field.id,{validation:_objectSpread(_objectSpread({},field.validation),{},{correctAnswers})});}}):/*#__PURE__*/_jsx(Radio,{checked:field.validation['correctAnswer']===option,onChange:()=>updateField(field.id,{validation:_objectSpread(_objectSpread({},field.validation),{},{correctAnswer:option})})}),label:\"Correct\"})]},optIdx)),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",size:\"small\",onClick:()=>{var _field$options6;const newOptions=[...((_field$options6=field.options)!==null&&_field$options6!==void 0?_field$options6:[]),\"Option \".concat(field.options.length+1)];updateField(field.id,{options:newOptions});},children:\"Add Option\"})]})]})}),/*#__PURE__*/_jsx(Divider,{})]},field.id);})})]}),showPreview&&fields.length>0&&/*#__PURE__*/_jsx(Box,{flex:1,children:/*#__PURE__*/_jsxs(Paper,{elevation:2,sx:{p:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Live Preview\"}),/*#__PURE__*/_jsxs(Box,{children:[fields.map(field=>field.label?renderPreviewField(field):null),fields.some(f=>f.derived)&&/*#__PURE__*/_jsx(Alert,{severity:\"info\",sx:{mt:2},children:\"Derived fields will auto-update as you change parent fields above.\"})]})]})})]}),/*#__PURE__*/_jsx(Box,{mt:3,children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:()=>setOpenDialog(true),disabled:fields.length===0,children:\"Save Form\"})}),/*#__PURE__*/_jsxs(Dialog,{open:openDialog,onClose:()=>setOpenDialog(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Save Form\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Form Name\",value:formName,onChange:e=>setFormName(e.target.value),margin:\"normal\"})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setOpenDialog(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:saveForm,variant:\"contained\",color:\"primary\",disabled:!formName,children:\"Save\"})]})]})]});};export default CreateForm;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}