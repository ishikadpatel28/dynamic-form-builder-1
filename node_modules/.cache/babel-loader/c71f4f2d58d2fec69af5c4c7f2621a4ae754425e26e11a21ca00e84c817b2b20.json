{"ast":null,"code":"import _objectSpread from\"C:/Users/ishik/VS code/Form/dynamic-form-builder/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState,useCallback}from'react';import{useParams}from'react-router-dom';import{Box,TextField,Typography,Checkbox,FormControlLabel,Select,MenuItem,RadioGroup,Radio,FormHelperText,Button,Alert}from'@mui/material';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PreviewForm=()=>{const[schema,setSchema]=useState(null);const[values,setValues]=useState({});const[errors,setErrors]=useState({});const[submitted,setSubmitted]=useState(false);const[result,setResult]=useState(null);const{formId}=useParams();useEffect(()=>{if(!formId)return;const stored=localStorage.getItem(formId);if(stored){const parsed=JSON.parse(stored);setSchema(parsed);const defaults={};parsed.fields.forEach(f=>{if(!f.derived){defaults[f.id]=f.defaultValue||(f.type==='checkbox'?[]:'');}});setValues(defaults);}},[formId]);const evalFormula=useCallback((formula,context)=>{try{let contextValues=Object.values(context);if(contextValues.some(val=>val===''||val===undefined||val===null)){return'';}const safeContext=_objectSpread({},context);const helpers={Date:Date,Math:Math,parseInt:parseInt,parseFloat:parseFloat,calculateAge:birthDate=>{if(!birthDate)return 0;const today=new Date();const birth=new Date(birthDate);if(isNaN(birth.getTime()))return 0;let age=today.getFullYear()-birth.getFullYear();const monthDiff=today.getMonth()-birth.getMonth();if(monthDiff<0||monthDiff===0&&today.getDate()<birth.getDate()){age--;}return age;}};const evalContext=_objectSpread(_objectSpread({},safeContext),helpers);const params=Object.keys(evalContext);contextValues=Object.values(evalContext);const func=new Function(...params,\"\\\"use strict\\\"; return (\".concat(formula,\");\"));return func(...contextValues);}catch(error){console.error('Formula evaluation error:',error,'Formula:',formula,'Context:',context);return'Error';}},[]);const updateDerivedFields=useCallback(currentValues=>{if(!schema)return currentValues;const newValues=_objectSpread({},currentValues);let hasChanges=false;schema.fields.forEach(field=>{if(field.derived&&field.parentFields&&field.formula){const context={};let hasAllParents=true;field.parentFields.forEach(parentId=>{const parentField=schema.fields.find(f=>f.id===parentId);if(parentField&&parentId in currentValues){const variableName=parentField.label.toLowerCase().replace(/\\s+/g,'_');context[variableName]=currentValues[parentId];}else{hasAllParents=false;}});if(hasAllParents){const computedValue=evalFormula(field.formula,context);if(newValues[field.id]!==computedValue){newValues[field.id]=computedValue;hasChanges=true;}}else{if(field.id in newValues){delete newValues[field.id];hasChanges=true;}}}});return hasChanges?newValues:currentValues;},[schema,evalFormula]);useEffect(()=>{if(!schema||Object.keys(values).length===0)return;const updatedValues=updateDerivedFields(values);if(updatedValues!==values){setValues(updatedValues);}},[schema,values,updateDerivedFields]);const validateField=useCallback((field,value)=>{const{validation}=field;if(validation.required&&(!value||Array.isArray(value)&&value.length===0)){return'This field is required.';}if(typeof value==='string'){if(validation.minLength&&value.length<validation.minLength){return\"Minimum length is \".concat(validation.minLength);}if(validation.maxLength&&value.length>validation.maxLength){return\"Maximum length is \".concat(validation.maxLength);}if(validation.email&&value&&!/^\\S+@\\S+\\.\\S+$/.test(value)){return'Invalid email format.';}if(validation.password&&value&&(!/^.{8,}$/.test(value)||!/\\d/.test(value))){return'Password must be at least 8 characters and contain a number.';}}return'';},[]);const handleChange=useCallback((id,value)=>{const newValues=_objectSpread(_objectSpread({},values),{},{[id]:value});const updatedValues=updateDerivedFields(newValues);setValues(updatedValues);const field=schema===null||schema===void 0?void 0:schema.fields.find(f=>f.id===id);if(field&&!field.derived){const err=validateField(field,value);setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{[id]:err}));}},[values,updateDerivedFields,schema,validateField]);const handleSubmit=e=>{e.preventDefault();setSubmitted(true);const newErrors={};schema===null||schema===void 0?void 0:schema.fields.forEach(field=>{if(!field.derived){const err=validateField(field,values[field.id]);if(err)newErrors[field.id]=err;}});setErrors(newErrors);let correct=true;let feedback='';schema===null||schema===void 0?void 0:schema.fields.forEach(field=>{const fieldValue=values[field.id];if((field.type==='radio'||field.type==='select')&&field.validation.correctAnswer){if(fieldValue!==field.validation.correctAnswer){correct=false;feedback+=\"\".concat(field.label,\": Incorrect answer.\\n\");}}if(field.type==='checkbox'&&Array.isArray(field.validation.correctAnswers)){const userAnswers=Array.isArray(fieldValue)?fieldValue:[];const correctAnswers=field.validation.correctAnswers;if(userAnswers.length!==correctAnswers.length||!correctAnswers.every(ans=>userAnswers.includes(ans))){correct=false;feedback+=\"\".concat(field.label,\": Incorrect answer.\\n\");}}});setResult(correct?'All answers are correct!':feedback||'Some answers are incorrect.');if(Object.keys(newErrors).length===0){console.log('Form Values:',values);alert('Form submitted successfully (check console for values)!');}};if(!schema){return/*#__PURE__*/_jsx(Typography,{children:\"Loading form...\"});}return/*#__PURE__*/_jsxs(Box,{p:4,children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h4\",gutterBottom:true,children:[\"Preview: \",schema.name]}),/*#__PURE__*/_jsxs(Box,{component:\"form\",display:\"flex\",flexDirection:\"column\",gap:3,onSubmit:handleSubmit,children:[schema.fields.map(field=>{var _values$field$id,_errors$field$id,_field$options,_field$options2,_field$options3;const value=(_values$field$id=values[field.id])!==null&&_values$field$id!==void 0?_values$field$id:field.type==='checkbox'?[]:'';const error=(_errors$field$id=errors[field.id])!==null&&_errors$field$id!==void 0?_errors$field$id:'';const isDisabled=field.derived||false;switch(field.type){case'text':case'number':case'date':return/*#__PURE__*/_jsx(TextField,{type:field.type,label:\"\".concat(field.label).concat(isDisabled?' (Auto-calculated)':''),value:value,onChange:e=>handleChange(field.id,e.target.value),error:!!error,helperText:error||(isDisabled?'This field is automatically calculated':''),disabled:isDisabled,sx:isDisabled?{'& .MuiInputBase-input':{color:'text.secondary'}}:{}},field.id);case'textarea':return/*#__PURE__*/_jsx(TextField,{label:\"\".concat(field.label).concat(isDisabled?' (Auto-calculated)':''),value:value,onChange:e=>handleChange(field.id,e.target.value),error:!!error,helperText:error||(isDisabled?'This field is automatically calculated':''),multiline:true,rows:3,disabled:isDisabled,sx:isDisabled?{'& .MuiInputBase-input':{color:'text.secondary'}}:{}},field.id);case'select':return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Typography,{children:[field.label,isDisabled?' (Auto-calculated)':'']}),/*#__PURE__*/_jsx(Select,{fullWidth:true,value:value,onChange:e=>handleChange(field.id,e.target.value),disabled:isDisabled,sx:isDisabled?{color:'text.secondary'}:{},children:(_field$options=field.options)===null||_field$options===void 0?void 0:_field$options.map((opt,i)=>/*#__PURE__*/_jsx(MenuItem,{value:opt,children:opt},i))}),error&&/*#__PURE__*/_jsx(FormHelperText,{error:true,children:error}),isDisabled&&/*#__PURE__*/_jsx(FormHelperText,{children:\"This field is automatically calculated\"})]},field.id);case'radio':return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Typography,{children:[field.label,isDisabled?' (Auto-calculated)':'']}),/*#__PURE__*/_jsx(RadioGroup,{value:value,onChange:e=>handleChange(field.id,e.target.value),children:(_field$options2=field.options)===null||_field$options2===void 0?void 0:_field$options2.map((opt,i)=>/*#__PURE__*/_jsx(FormControlLabel,{value:opt,control:/*#__PURE__*/_jsx(Radio,{disabled:isDisabled}),label:opt,sx:isDisabled?{color:'text.secondary'}:{}},i))}),error&&/*#__PURE__*/_jsx(FormHelperText,{error:true,children:error}),isDisabled&&/*#__PURE__*/_jsx(FormHelperText,{children:\"This field is automatically calculated\"})]},field.id);case'checkbox':return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Typography,{children:[field.label,isDisabled?' (Auto-calculated)':'']}),(_field$options3=field.options)===null||_field$options3===void 0?void 0:_field$options3.map((opt,i)=>/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{checked:Array.isArray(value)&&value.includes(opt),onChange:e=>{if(!isDisabled){const checked=e.target.checked;const currentValue=Array.isArray(value)?value:[];const newValue=checked?[...currentValue,opt]:currentValue.filter(v=>v!==opt);handleChange(field.id,newValue);}},disabled:isDisabled}),label:opt,sx:isDisabled?{color:'text.secondary'}:{}},i)),error&&/*#__PURE__*/_jsx(FormHelperText,{error:true,children:error}),isDisabled&&/*#__PURE__*/_jsx(FormHelperText,{children:\"This field is automatically calculated\"})]},field.id);default:return null;}}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",type:\"submit\",size:\"large\",children:\"Submit\"})]}),submitted&&result&&/*#__PURE__*/_jsx(Box,{mt:2,children:/*#__PURE__*/_jsx(Alert,{severity:result==='All answers are correct!'?'success':'error',children:result})})]});};export default PreviewForm;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}