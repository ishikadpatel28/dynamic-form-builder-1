{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ishik\\\\VS code\\\\Form\\\\dynamic-form-builder\\\\src\\\\components\\\\PreviewForm.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useCallback, useMemo } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { Box, TextField, Typography, Checkbox, FormControlLabel, Select, MenuItem, RadioGroup, Radio, FormHelperText, Button, Alert } from '@mui/material';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst PreviewForm = () => {\n  _s();\n  const [schema, setSchema] = useState(null);\n  const [values, setValues] = useState({});\n  const [errors, setErrors] = useState({});\n  const [submitted, setSubmitted] = useState(false);\n  const [result, setResult] = useState(null);\n  const {\n    formId\n  } = useParams();\n  useEffect(() => {\n    if (!formId) return;\n    const stored = localStorage.getItem(formId);\n    if (stored) {\n      const parsed = JSON.parse(stored);\n      setSchema(parsed);\n      const defaults = {};\n      parsed.fields.forEach(f => {\n        if (!f.derived) {\n          defaults[f.id] = f.defaultValue || (f.type === 'checkbox' ? [] : '');\n        }\n      });\n      setValues(defaults);\n    }\n  }, [formId]);\n  const derivedFieldDeps = useMemo(() => {\n    if (!schema) return {};\n    const deps = {};\n    schema.fields.forEach(field => {\n      if (field.derived && field.parentFields) {\n        deps[field.id] = field.parentFields;\n      }\n    });\n    return deps;\n  }, [schema]);\n  const evalFormula = useCallback((formula, context) => {\n    try {\n      // Skip if context has any empty, null, or undefined values\n      if (Object.values(context).some(val => val === '' || val === undefined || val === null)) {\n        console.warn('Skipping formula due to incomplete context:', context);\n        return '';\n      }\n      const safeContext = {\n        ...context\n      };\n      const helpers = {\n        Date: Date,\n        Math: Math,\n        parseInt: parseInt,\n        parseFloat: parseFloat,\n        calculateAge: birthDate => {\n          if (!birthDate) return 0;\n          const today = new Date();\n          const birth = new Date(birthDate);\n          if (isNaN(birth.getTime())) return 0;\n          let age = today.getFullYear() - birth.getFullYear();\n          const monthDiff = today.getMonth() - birth.getMonth();\n          if (monthDiff < 0 || monthDiff === 0 && today.getDate() < birth.getDate()) {\n            age--;\n          }\n          return age;\n        }\n      };\n      const evalContext = {\n        ...safeContext,\n        ...helpers\n      };\n      const params = Object.keys(evalContext);\n      const values = Object.values(evalContext);\n\n      // ðŸ§¼ Sanitize the formula string:\n      const cleanedFormula = formula.replace(/[â€œâ€]/g, '\"') // curly double quotes â†’ straight\n      .replace(/[â€˜â€™]/g, \"'\") // curly single quotes â†’ straight\n      .replace(/[^\\x20-\\x7E]+/g, ''); // remove all non-printable ASCII\n\n      const func = new Function(...params, `\"use strict\"; return (${cleanedFormula});`);\n      return func(...values);\n    } catch (error) {\n      console.error('Formula evaluation error:', error, 'Formula:', formula, 'Context:', context);\n      return 'Error';\n    }\n  }, []);\n  useEffect(() => {\n    if (!schema || Object.keys(values).length === 0) return;\n    const newValues = {\n      ...values\n    };\n    let hasChanges = false;\n    schema.fields.forEach(field => {\n      if (field.derived && field.parentFields && field.formula) {\n        const context = {};\n        let hasAllParents = true;\n        field.parentFields.forEach(parentId => {\n          const parentField = schema.fields.find(f => f.id === parentId);\n          if (parentField && parentId in values) {\n            context[parentId] = values[parentId];\n            context[parentField.label.toLowerCase().replace(/\\s+/g, '_')] = values[parentId];\n            if (parentField.label.toLowerCase() === 'dob' || parentField.label.toLowerCase().includes('birth')) {\n              context['dob'] = values[parentId];\n            }\n          } else {\n            hasAllParents = false;\n          }\n        });\n        if (hasAllParents) {\n          console.log(`Processing derived field: ${field.label}, formula: ${field.formula}, context:`, context);\n          const computedValue = evalFormula(field.formula, context);\n          if (newValues[field.id] !== computedValue) {\n            console.log(`Updating derived field ${field.label} from ${newValues[field.id]} to ${computedValue}`);\n            newValues[field.id] = computedValue;\n            hasChanges = true;\n          }\n        } else if (field.id in newValues) {\n          delete newValues[field.id];\n          hasChanges = true;\n        }\n      }\n    });\n    if (hasChanges) {\n      console.log('Updating values with derived field changes:', newValues);\n      setValues(newValues);\n    }\n  }, [schema, values, evalFormula]);\n  const validateField = useCallback((field, value) => {\n    const {\n      validation\n    } = field;\n    if (validation.required && (!value || Array.isArray(value) && value.length === 0)) {\n      return 'This field is required.';\n    }\n    if (typeof value === 'string') {\n      if (validation.minLength && value.length < validation.minLength) {\n        return `Minimum length is ${validation.minLength}`;\n      }\n      if (validation.maxLength && value.length > validation.maxLength) {\n        return `Maximum length is ${validation.maxLength}`;\n      }\n      if (validation.email && value && !/^\\S+@\\S+\\.\\S+$/.test(value)) {\n        return 'Invalid email format.';\n      }\n      if (validation.password && value && (!/^.{8,}$/.test(value) || !/\\d/.test(value))) {\n        return 'Password must be at least 8 characters and contain a number.';\n      }\n    }\n    return '';\n  }, []);\n  const handleChange = useCallback((id, value) => {\n    setValues(prev => ({\n      ...prev,\n      [id]: value\n    }));\n    const field = schema === null || schema === void 0 ? void 0 : schema.fields.find(f => f.id === id);\n    if (field && !field.derived) {\n      const err = validateField(field, value);\n      setErrors(prev => ({\n        ...prev,\n        [id]: err\n      }));\n    }\n  }, [schema, validateField]);\n  const handleSubmit = e => {\n    e.preventDefault();\n    setSubmitted(true);\n    const newErrors = {};\n    schema === null || schema === void 0 ? void 0 : schema.fields.forEach(field => {\n      if (!field.derived) {\n        const err = validateField(field, values[field.id]);\n        if (err) newErrors[field.id] = err;\n      }\n    });\n    setErrors(newErrors);\n    let correct = true;\n    let feedback = '';\n    schema === null || schema === void 0 ? void 0 : schema.fields.forEach(field => {\n      const fieldValue = values[field.id];\n      if ((field.type === 'radio' || field.type === 'select') && field.validation.correctAnswer) {\n        if (fieldValue !== field.validation.correctAnswer) {\n          correct = false;\n          feedback += `${field.label}: Incorrect answer.\\n`;\n        }\n      }\n      if (field.type === 'checkbox' && Array.isArray(field.validation.correctAnswers)) {\n        const userAnswers = Array.isArray(fieldValue) ? fieldValue : [];\n        const correctAnswers = field.validation.correctAnswers;\n        if (userAnswers.length !== correctAnswers.length || !correctAnswers.every(ans => userAnswers.includes(ans))) {\n          correct = false;\n          feedback += `${field.label}: Incorrect answer.\\n`;\n        }\n      }\n    });\n    setResult(correct ? 'All answers are correct!' : feedback || 'Some answers are incorrect.');\n    if (Object.keys(newErrors).length === 0) {\n      console.log('Form Values:', values);\n      alert('Form submitted successfully (check console for values)!');\n    }\n  };\n  if (!schema) {\n    return /*#__PURE__*/_jsxDEV(Typography, {\n      children: \"Loading form...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 16\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(Box, {\n    p: 4,\n    children: [/*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h4\",\n      gutterBottom: true,\n      children: [\"Preview: \", schema.name]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      component: \"form\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      gap: 3,\n      onSubmit: handleSubmit,\n      children: [schema.fields.map(field => {\n        var _values$field$id, _errors$field$id, _field$options, _field$options2, _field$options3;\n        const value = (_values$field$id = values[field.id]) !== null && _values$field$id !== void 0 ? _values$field$id : field.type === 'checkbox' ? [] : '';\n        const error = (_errors$field$id = errors[field.id]) !== null && _errors$field$id !== void 0 ? _errors$field$id : '';\n        const isDisabled = field.derived || false;\n        switch (field.type) {\n          case 'text':\n          case 'number':\n          case 'date':\n            return /*#__PURE__*/_jsxDEV(TextField, {\n              type: field.type,\n              label: `${field.label}${isDisabled ? ' (Auto-calculated)' : ''}`,\n              value: value,\n              onChange: e => handleChange(field.id, e.target.value),\n              error: !!error,\n              helperText: error || (isDisabled ? 'This field is automatically calculated' : ''),\n              disabled: isDisabled,\n              sx: isDisabled ? {\n                '& .MuiInputBase-input': {\n                  color: 'text.secondary'\n                }\n              } : {}\n            }, field.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 287,\n              columnNumber: 33\n            }, this);\n          case 'textarea':\n            return /*#__PURE__*/_jsxDEV(TextField, {\n              label: `${field.label}${isDisabled ? ' (Auto-calculated)' : ''}`,\n              value: value,\n              onChange: e => handleChange(field.id, e.target.value),\n              error: !!error,\n              helperText: error || (isDisabled ? 'This field is automatically calculated' : ''),\n              multiline: true,\n              rows: 3,\n              disabled: isDisabled,\n              sx: isDisabled ? {\n                '& .MuiInputBase-input': {\n                  color: 'text.secondary'\n                }\n              } : {}\n            }, field.id, false, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 33\n            }, this);\n          case 'select':\n            return /*#__PURE__*/_jsxDEV(Box, {\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                children: [field.label, isDisabled ? ' (Auto-calculated)' : '']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 319,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(Select, {\n                fullWidth: true,\n                value: value,\n                onChange: e => handleChange(field.id, e.target.value),\n                disabled: isDisabled,\n                sx: isDisabled ? {\n                  color: 'text.secondary'\n                } : {},\n                children: (_field$options = field.options) === null || _field$options === void 0 ? void 0 : _field$options.map((opt, i) => /*#__PURE__*/_jsxDEV(MenuItem, {\n                  value: opt,\n                  children: opt\n                }, i, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 330,\n                  columnNumber: 45\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 322,\n                columnNumber: 37\n              }, this), error && /*#__PURE__*/_jsxDEV(FormHelperText, {\n                error: true,\n                children: error\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 335,\n                columnNumber: 47\n              }, this), isDisabled && /*#__PURE__*/_jsxDEV(FormHelperText, {\n                children: \"This field is automatically calculated\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 336,\n                columnNumber: 52\n              }, this)]\n            }, field.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 318,\n              columnNumber: 33\n            }, this);\n          case 'radio':\n            return /*#__PURE__*/_jsxDEV(Box, {\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                children: [field.label, isDisabled ? ' (Auto-calculated)' : '']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 343,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(RadioGroup, {\n                value: value,\n                onChange: e => handleChange(field.id, e.target.value),\n                children: (_field$options2 = field.options) === null || _field$options2 === void 0 ? void 0 : _field$options2.map((opt, i) => /*#__PURE__*/_jsxDEV(FormControlLabel, {\n                  value: opt,\n                  control: /*#__PURE__*/_jsxDEV(Radio, {\n                    disabled: isDisabled\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 354,\n                    columnNumber: 58\n                  }, this),\n                  label: opt,\n                  sx: isDisabled ? {\n                    color: 'text.secondary'\n                  } : {}\n                }, i, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 351,\n                  columnNumber: 45\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 346,\n                columnNumber: 37\n              }, this), error && /*#__PURE__*/_jsxDEV(FormHelperText, {\n                error: true,\n                children: error\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 360,\n                columnNumber: 47\n              }, this), isDisabled && /*#__PURE__*/_jsxDEV(FormHelperText, {\n                children: \"This field is automatically calculated\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 361,\n                columnNumber: 52\n              }, this)]\n            }, field.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 342,\n              columnNumber: 33\n            }, this);\n          case 'checkbox':\n            return /*#__PURE__*/_jsxDEV(Box, {\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                children: [field.label, isDisabled ? ' (Auto-calculated)' : '']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 368,\n                columnNumber: 37\n              }, this), (_field$options3 = field.options) === null || _field$options3 === void 0 ? void 0 : _field$options3.map((opt, i) => /*#__PURE__*/_jsxDEV(FormControlLabel, {\n                control: /*#__PURE__*/_jsxDEV(Checkbox, {\n                  checked: Array.isArray(value) && value.includes(opt),\n                  onChange: e => {\n                    if (!isDisabled) {\n                      const checked = e.target.checked;\n                      const currentValue = Array.isArray(value) ? value : [];\n                      const newValue = checked ? [...currentValue, opt] : currentValue.filter(v => v !== opt);\n                      handleChange(field.id, newValue);\n                    }\n                  },\n                  disabled: isDisabled\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 375,\n                  columnNumber: 49\n                }, this),\n                label: opt,\n                sx: isDisabled ? {\n                  color: 'text.secondary'\n                } : {}\n              }, i, false, {\n                fileName: _jsxFileName,\n                lineNumber: 372,\n                columnNumber: 41\n              }, this)), error && /*#__PURE__*/_jsxDEV(FormHelperText, {\n                error: true,\n                children: error\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 394,\n                columnNumber: 47\n              }, this), isDisabled && /*#__PURE__*/_jsxDEV(FormHelperText, {\n                children: \"This field is automatically calculated\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 395,\n                columnNumber: 52\n              }, this)]\n            }, field.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 367,\n              columnNumber: 33\n            }, this);\n          default:\n            return null;\n        }\n      }), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        type: \"submit\",\n        size: \"large\",\n        children: \"Submit\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 276,\n      columnNumber: 13\n    }, this), submitted && result && /*#__PURE__*/_jsxDEV(Box, {\n      mt: 2,\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        severity: result === 'All answers are correct!' ? 'success' : 'error',\n        children: result\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 271,\n    columnNumber: 9\n  }, this);\n};\n_s(PreviewForm, \"Yqh8RGLCnBJ1DsH+fGbIm6HhtgA=\", false, function () {\n  return [useParams];\n});\n_c = PreviewForm;\nexport default PreviewForm;\nvar _c;\n$RefreshReg$(_c, \"PreviewForm\");","map":{"version":3,"names":["React","useEffect","useState","useCallback","useMemo","useParams","Box","TextField","Typography","Checkbox","FormControlLabel","Select","MenuItem","RadioGroup","Radio","FormHelperText","Button","Alert","jsxDEV","_jsxDEV","PreviewForm","_s","schema","setSchema","values","setValues","errors","setErrors","submitted","setSubmitted","result","setResult","formId","stored","localStorage","getItem","parsed","JSON","parse","defaults","fields","forEach","f","derived","id","defaultValue","type","derivedFieldDeps","deps","field","parentFields","evalFormula","formula","context","Object","some","val","undefined","console","warn","safeContext","helpers","Date","Math","parseInt","parseFloat","calculateAge","birthDate","today","birth","isNaN","getTime","age","getFullYear","monthDiff","getMonth","getDate","evalContext","params","keys","cleanedFormula","replace","func","Function","error","length","newValues","hasChanges","hasAllParents","parentId","parentField","find","label","toLowerCase","includes","log","computedValue","validateField","value","validation","required","Array","isArray","minLength","maxLength","email","test","password","handleChange","prev","err","handleSubmit","e","preventDefault","newErrors","correct","feedback","fieldValue","correctAnswer","correctAnswers","userAnswers","every","ans","alert","children","fileName","_jsxFileName","lineNumber","columnNumber","p","variant","gutterBottom","name","component","display","flexDirection","gap","onSubmit","map","_values$field$id","_errors$field$id","_field$options","_field$options2","_field$options3","isDisabled","onChange","target","helperText","disabled","sx","color","multiline","rows","fullWidth","options","opt","i","control","checked","currentValue","newValue","filter","v","size","mt","severity","_c","$RefreshReg$"],"sources":["C:/Users/ishik/VS code/Form/dynamic-form-builder/src/components/PreviewForm.tsx"],"sourcesContent":["import React, { useEffect, useState, useCallback, useMemo } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\nimport {\r\n    Box,\r\n    TextField,\r\n    Typography,\r\n    Checkbox,\r\n    FormControlLabel,\r\n    Select,\r\n    MenuItem,\r\n    RadioGroup,\r\n    Radio,\r\n    FormHelperText,\r\n    Button,\r\n    Alert,\r\n} from '@mui/material';\r\n\r\ninterface Validation {\r\n    required: boolean;\r\n    minLength?: number;\r\n    maxLength?: number;\r\n    email?: boolean;\r\n    password?: boolean;\r\n    correctAnswers?: string[];\r\n    correctAnswer?: string;\r\n}\r\n\r\ninterface Field {\r\n    derived?: boolean;\r\n    parentFields?: string[];\r\n    formula?: string;\r\n    id: string;\r\n    type: string;\r\n    label: string;\r\n    defaultValue?: string;\r\n    options?: string[];\r\n    validation: Validation;\r\n}\r\n\r\ninterface FormSchema {\r\n    name: string;\r\n    fields: Field[];\r\n}\r\n\r\nconst PreviewForm: React.FC = () => {\r\n    const [schema, setSchema] = useState<FormSchema | null>(null);\r\n    const [values, setValues] = useState<Record<string, any>>({});\r\n    const [errors, setErrors] = useState<Record<string, string>>({});\r\n    const [submitted, setSubmitted] = useState(false);\r\n    const [result, setResult] = useState<string | null>(null);\r\n\r\n    const { formId } = useParams<{ formId: string }>();\r\n\r\n    useEffect(() => {\r\n        if (!formId) return;\r\n\r\n        const stored = localStorage.getItem(formId);\r\n        if (stored) {\r\n            const parsed = JSON.parse(stored) as FormSchema;\r\n            setSchema(parsed);\r\n\r\n            const defaults: Record<string, any> = {};\r\n            parsed.fields.forEach((f) => {\r\n                if (!f.derived) {\r\n                    defaults[f.id] = f.defaultValue || (f.type === 'checkbox' ? [] : '');\r\n                }\r\n            });\r\n            setValues(defaults);\r\n        }\r\n    }, [formId]);\r\n\r\n    const derivedFieldDeps = useMemo(() => {\r\n        if (!schema) return {};\r\n\r\n        const deps: Record<string, string[]> = {};\r\n        schema.fields.forEach(field => {\r\n            if (field.derived && field.parentFields) {\r\n                deps[field.id] = field.parentFields;\r\n            }\r\n        });\r\n        return deps;\r\n    }, [schema]);\r\n\r\n    const evalFormula = useCallback((formula: string, context: Record<string, any>) => {\r\n    try {\r\n        // Skip if context has any empty, null, or undefined values\r\n        if (Object.values(context).some(val => val === '' || val === undefined || val === null)) {\r\n            console.warn('Skipping formula due to incomplete context:', context);\r\n            return '';\r\n        }\r\n\r\n        const safeContext = { ...context };\r\n\r\n        const helpers = {\r\n            Date: Date,\r\n            Math: Math,\r\n            parseInt: parseInt,\r\n            parseFloat: parseFloat,\r\n            calculateAge: (birthDate: string) => {\r\n                if (!birthDate) return 0;\r\n                const today = new Date();\r\n                const birth = new Date(birthDate);\r\n                if (isNaN(birth.getTime())) return 0;\r\n\r\n                let age = today.getFullYear() - birth.getFullYear();\r\n                const monthDiff = today.getMonth() - birth.getMonth();\r\n\r\n                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {\r\n                    age--;\r\n                }\r\n                return age;\r\n            }\r\n        };\r\n\r\n        const evalContext = { ...safeContext, ...helpers };\r\n\r\n        const params = Object.keys(evalContext);\r\n        const values = Object.values(evalContext);\r\n\r\n        // ðŸ§¼ Sanitize the formula string:\r\n        const cleanedFormula = formula\r\n            .replace(/[â€œâ€]/g, '\"')           // curly double quotes â†’ straight\r\n            .replace(/[â€˜â€™]/g, \"'\")           // curly single quotes â†’ straight\r\n            .replace(/[^\\x20-\\x7E]+/g, '')   // remove all non-printable ASCII\r\n\r\n        const func = new Function(...params, `\"use strict\"; return (${cleanedFormula});`);\r\n        return func(...values);\r\n    } catch (error) {\r\n        console.error('Formula evaluation error:', error, 'Formula:', formula, 'Context:', context);\r\n        return 'Error';\r\n    }\r\n}, []);\r\n\r\n\r\n\r\n    useEffect(() => {\r\n        if (!schema || Object.keys(values).length === 0) return;\r\n\r\n        const newValues = { ...values };\r\n        let hasChanges = false;\r\n\r\n        schema.fields.forEach(field => {\r\n            if (field.derived && field.parentFields && field.formula) {\r\n                const context: Record<string, any> = {};\r\n                let hasAllParents = true;\r\n\r\n                field.parentFields.forEach(parentId => {\r\n                    const parentField = schema.fields.find(f => f.id === parentId);\r\n                    if (parentField && parentId in values) {\r\n                        context[parentId] = values[parentId];\r\n                        context[parentField.label.toLowerCase().replace(/\\s+/g, '_')] = values[parentId];\r\n                        if (parentField.label.toLowerCase() === 'dob' || parentField.label.toLowerCase().includes('birth')) {\r\n                            context['dob'] = values[parentId];\r\n                        }\r\n                    } else {\r\n                        hasAllParents = false;\r\n                    }\r\n                });\r\n\r\n                if (hasAllParents) {\r\n                    console.log(`Processing derived field: ${field.label}, formula: ${field.formula}, context:`, context);\r\n                    const computedValue = evalFormula(field.formula, context);\r\n\r\n                    if (newValues[field.id] !== computedValue) {\r\n                        console.log(`Updating derived field ${field.label} from ${newValues[field.id]} to ${computedValue}`);\r\n                        newValues[field.id] = computedValue;\r\n                        hasChanges = true;\r\n                    }\r\n                } else if (field.id in newValues) {\r\n                    delete newValues[field.id];\r\n                    hasChanges = true;\r\n                }\r\n            }\r\n        });\r\n\r\n        if (hasChanges) {\r\n            console.log('Updating values with derived field changes:', newValues);\r\n            setValues(newValues);\r\n        }\r\n    }, [schema, values, evalFormula]);\r\n\r\n    const validateField = useCallback((field: Field, value: any): string => {\r\n        const { validation } = field;\r\n\r\n        if (validation.required && (!value || (Array.isArray(value) && value.length === 0))) {\r\n            return 'This field is required.';\r\n        }\r\n\r\n        if (typeof value === 'string') {\r\n            if (validation.minLength && value.length < validation.minLength) {\r\n                return `Minimum length is ${validation.minLength}`;\r\n            }\r\n            if (validation.maxLength && value.length > validation.maxLength) {\r\n                return `Maximum length is ${validation.maxLength}`;\r\n            }\r\n            if (validation.email && value && !/^\\S+@\\S+\\.\\S+$/.test(value)) {\r\n                return 'Invalid email format.';\r\n            }\r\n            if (validation.password && value &&\r\n                (!/^.{8,}$/.test(value) || !/\\d/.test(value))) {\r\n                return 'Password must be at least 8 characters and contain a number.';\r\n            }\r\n        }\r\n\r\n        return '';\r\n    }, []);\r\n\r\n    const handleChange = useCallback((id: string, value: any) => {\r\n        setValues(prev => ({ ...prev, [id]: value }));\r\n\r\n        const field = schema?.fields.find(f => f.id === id);\r\n        if (field && !field.derived) {\r\n            const err = validateField(field, value);\r\n            setErrors(prev => ({ ...prev, [id]: err }));\r\n        }\r\n    }, [schema, validateField]);\r\n\r\n    const handleSubmit = (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setSubmitted(true);\r\n\r\n        const newErrors: Record<string, string> = {};\r\n\r\n        schema?.fields.forEach(field => {\r\n            if (!field.derived) {\r\n                const err = validateField(field, values[field.id]);\r\n                if (err) newErrors[field.id] = err;\r\n            }\r\n        });\r\n\r\n        setErrors(newErrors);\r\n\r\n        let correct = true;\r\n        let feedback = '';\r\n\r\n        schema?.fields.forEach(field => {\r\n            const fieldValue = values[field.id];\r\n\r\n            if ((field.type === 'radio' || field.type === 'select') && field.validation.correctAnswer) {\r\n                if (fieldValue !== field.validation.correctAnswer) {\r\n                    correct = false;\r\n                    feedback += `${field.label}: Incorrect answer.\\n`;\r\n                }\r\n            }\r\n\r\n            if (field.type === 'checkbox' && Array.isArray(field.validation.correctAnswers)) {\r\n                const userAnswers = Array.isArray(fieldValue) ? fieldValue : [];\r\n                const correctAnswers = field.validation.correctAnswers;\r\n\r\n                if (userAnswers.length !== correctAnswers.length ||\r\n                    !correctAnswers.every(ans => userAnswers.includes(ans))) {\r\n                    correct = false;\r\n                    feedback += `${field.label}: Incorrect answer.\\n`;\r\n                }\r\n            }\r\n        });\r\n\r\n        setResult(correct ? 'All answers are correct!' : feedback || 'Some answers are incorrect.');\r\n\r\n        if (Object.keys(newErrors).length === 0) {\r\n            console.log('Form Values:', values);\r\n            alert('Form submitted successfully (check console for values)!');\r\n        }\r\n    };\r\n\r\n    if (!schema) {\r\n        return <Typography>Loading form...</Typography>;\r\n    }\r\n\r\n    return (\r\n        <Box p={4}>\r\n            <Typography variant=\"h4\" gutterBottom>\r\n                Preview: {schema.name}\r\n            </Typography>\r\n\r\n            <Box component=\"form\" display=\"flex\" flexDirection=\"column\" gap={3} onSubmit={handleSubmit}>\r\n                {schema.fields.map(field => {\r\n                    const value = values[field.id] ?? (field.type === 'checkbox' ? [] : '');\r\n                    const error = errors[field.id] ?? '';\r\n                    const isDisabled = field.derived || false;\r\n\r\n                    switch (field.type) {\r\n                        case 'text':\r\n                        case 'number':\r\n                        case 'date':\r\n                            return (\r\n                                <TextField\r\n                                    key={field.id}\r\n                                    type={field.type}\r\n                                    label={`${field.label}${isDisabled ? ' (Auto-calculated)' : ''}`}\r\n                                    value={value}\r\n                                    onChange={(e) => handleChange(field.id, e.target.value)}\r\n                                    error={!!error}\r\n                                    helperText={error || (isDisabled ? 'This field is automatically calculated' : '')}\r\n                                    disabled={isDisabled}\r\n                                    sx={isDisabled ? { '& .MuiInputBase-input': { color: 'text.secondary' } } : {}}\r\n                                />\r\n                            );\r\n\r\n                        case 'textarea':\r\n                            return (\r\n                                <TextField\r\n                                    key={field.id}\r\n                                    label={`${field.label}${isDisabled ? ' (Auto-calculated)' : ''}`}\r\n                                    value={value}\r\n                                    onChange={(e) => handleChange(field.id, e.target.value)}\r\n                                    error={!!error}\r\n                                    helperText={error || (isDisabled ? 'This field is automatically calculated' : '')}\r\n                                    multiline\r\n                                    rows={3}\r\n                                    disabled={isDisabled}\r\n                                    sx={isDisabled ? { '& .MuiInputBase-input': { color: 'text.secondary' } } : {}}\r\n                                />\r\n                            );\r\n\r\n                        case 'select':\r\n                            return (\r\n                                <Box key={field.id}>\r\n                                    <Typography>\r\n                                        {field.label}{isDisabled ? ' (Auto-calculated)' : ''}\r\n                                    </Typography>\r\n                                    <Select\r\n                                        fullWidth\r\n                                        value={value}\r\n                                        onChange={(e) => handleChange(field.id, e.target.value)}\r\n                                        disabled={isDisabled}\r\n                                        sx={isDisabled ? { color: 'text.secondary' } : {}}\r\n                                    >\r\n                                        {field.options?.map((opt, i) => (\r\n                                            <MenuItem key={i} value={opt}>\r\n                                                {opt}\r\n                                            </MenuItem>\r\n                                        ))}\r\n                                    </Select>\r\n                                    {error && <FormHelperText error>{error}</FormHelperText>}\r\n                                    {isDisabled && <FormHelperText>This field is automatically calculated</FormHelperText>}\r\n                                </Box>\r\n                            );\r\n\r\n                        case 'radio':\r\n                            return (\r\n                                <Box key={field.id}>\r\n                                    <Typography>\r\n                                        {field.label}{isDisabled ? ' (Auto-calculated)' : ''}\r\n                                    </Typography>\r\n                                    <RadioGroup\r\n                                        value={value}\r\n                                        onChange={(e) => handleChange(field.id, e.target.value)}\r\n                                    >\r\n                                        {field.options?.map((opt, i) => (\r\n                                            <FormControlLabel\r\n                                                key={i}\r\n                                                value={opt}\r\n                                                control={<Radio disabled={isDisabled} />}\r\n                                                label={opt}\r\n                                                sx={isDisabled ? { color: 'text.secondary' } : {}}\r\n                                            />\r\n                                        ))}\r\n                                    </RadioGroup>\r\n                                    {error && <FormHelperText error>{error}</FormHelperText>}\r\n                                    {isDisabled && <FormHelperText>This field is automatically calculated</FormHelperText>}\r\n                                </Box>\r\n                            );\r\n\r\n                        case 'checkbox':\r\n                            return (\r\n                                <Box key={field.id}>\r\n                                    <Typography>\r\n                                        {field.label}{isDisabled ? ' (Auto-calculated)' : ''}\r\n                                    </Typography>\r\n                                    {field.options?.map((opt, i) => (\r\n                                        <FormControlLabel\r\n                                            key={i}\r\n                                            control={\r\n                                                <Checkbox\r\n                                                    checked={Array.isArray(value) && value.includes(opt)}\r\n                                                    onChange={(e) => {\r\n                                                        if (!isDisabled) {\r\n                                                            const checked = e.target.checked;\r\n                                                            const currentValue = Array.isArray(value) ? value : [];\r\n                                                            const newValue = checked\r\n                                                                ? [...currentValue, opt]\r\n                                                                : currentValue.filter(v => v !== opt);\r\n                                                            handleChange(field.id, newValue);\r\n                                                        }\r\n                                                    }}\r\n                                                    disabled={isDisabled}\r\n                                                />\r\n                                            }\r\n                                            label={opt}\r\n                                            sx={isDisabled ? { color: 'text.secondary' } : {}}\r\n                                        />\r\n                                    ))}\r\n                                    {error && <FormHelperText error>{error}</FormHelperText>}\r\n                                    {isDisabled && <FormHelperText>This field is automatically calculated</FormHelperText>}\r\n                                </Box>\r\n                            );\r\n\r\n                        default:\r\n                            return null;\r\n                    }\r\n                })}\r\n\r\n                <Button variant=\"contained\" type=\"submit\" size=\"large\">\r\n                    Submit\r\n                </Button>\r\n            </Box>\r\n\r\n            {submitted && result && (\r\n                <Box mt={2}>\r\n                    <Alert severity={result === 'All answers are correct!' ? 'success' : 'error'}>\r\n                        {result}\r\n                    </Alert>\r\n                </Box>\r\n            )}\r\n        </Box>\r\n    );\r\n};\r\n\r\nexport default PreviewForm;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}